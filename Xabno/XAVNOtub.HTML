<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–•–∞–≤–Ω–æ–¢–Æ–ë - –õ—É—á—à–∏–µ –≤–∏–¥–æ—Å–∏–∫–∏!</title>
    <style>
        body {
            font-family: 'Comic Sans MS', cursive;
            background-color: #f0fff0;
            margin: 0;
            padding: 0;
        }
        header {
            background-color: #8A2BE2;
            color: white;
            padding: 10px 20px;
            font-size: 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .upload-btn {
            background-color: #8A2BE2;
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
        }
        .user-actions {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .video-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            padding: 20px;
            justify-content: center;
        }
        .video-card {
            background-color: white;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 15px;
            width: 300px;
            cursor: pointer;
            position: relative;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }
        .video-card:hover {
            transform: translateY(-5px);
        }
        .video-card img {
            width: 100%;
            height: 180px;
            object-fit: cover;
            border-radius: 5px;
        }
        .video-title {
            font-weight: bold;
            margin: 10px 0;
            color: #333;
            font-size: 16px;
        }
        .video-views {
            color: #777;
            font-size: 14px;
        }
        .upload-form, .auth-form, .admin-form {
            background-color: white;
            padding: 20px;
            margin: 20px auto;
            border-radius: 10px;
            border: 2px solid #8A2BE2;
            max-width: 500px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            display: none;
            position: absolute;
            top: 70px;
            left: 20px;
            z-index: 100;
        }
        button {
            background-color: #8A2BE2;
            color: white;
            border: none;
            padding: 8px 15px;
            cursor: pointer;
            border-radius: 5px;
            margin: 5px;
            transition: background-color 0.3s;
            font-size: 14px;
        }
        button:hover {
            background-color: #7B1FA2;
        }
        input {
            padding: 8px;
            margin: 5px 0;
            width: 100%;
            box-sizing: border-box;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .video-player {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .video-player-content {
            width: 80%;
            max-width: 800px;
            position: relative;
        }
        .close-player {
            position: absolute;
            top: -40px;
            right: 0;
            color: white;
            font-size: 30px;
            cursor: pointer;
        }
        .username-display {
            font-weight: bold;
        }
        .logout-btn {
            background-color: #f44336;
        }
        .admin-btn {
            background-color: #FF5722;
            padding: 8px 15px;
            font-size: 14px;
            margin-left: 10px;
        }
        .delete-btn {
            background-color: #f44336;
            position: absolute;
            top: 5px;
            right: 5px;
            padding: 5px 8px;
            font-size: 12px;
        }
        .verified-badge {
            color: #1da1f2;
            font-size: 14px;
            margin-left: 5px;
        }
        .subscribe-btn {
            background-color: #4CAF50;
        }
        .unsubscribe-btn {
            background-color: #9E9E9E;
        }
        .file-upload {
            margin: 10px 0;
        }
        .progress-bar {
            width: 100%;
            background-color: #ddd;
            margin: 10px 0;
            display: none;
            border-radius: 4px;
            overflow: hidden;
        }
        .progress {
            height: 20px;
            background-color: #4CAF50;
            width: 0%;
            transition: width 0.3s;
        }
        .admin-panel {
            display: none;
            padding: 20px;
            background-color: white;
            border-radius: 10px;
            margin: 20px auto;
            max-width: 1000px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .user-list {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        .user-list th, .user-list td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        .user-list th {
            background-color: #8A2BE2;
            color: white;
        }
        .user-list tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        .ban-btn {
            background-color: #f44336;
            padding: 5px 10px;
            font-size: 12px;
        }
        .unban-btn {
            background-color: #4CAF50;
            padding: 5px 10px;
            font-size: 12px;
        }
        .reset-btn {
            background-color: #FFC107;
            padding: 5px 10px;
            font-size: 12px;
            color: #333;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1001;
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            max-width: 500px;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .close-form {
            position: absolute;
            top: 10px;
            right: 10px;
            cursor: pointer;
            font-size: 20px;
            color: #777;
        }
    </style>
</head>
<body>
    <header>
        <div style="display: flex; align-items: center;">
            <button class="upload-btn" id="show-upload-form" onclick="toggleUploadForm()">+</button>
            <h1>–•–ê–í–ù–û–¢–Æ–ë</h1>
        </div>
        <div class="user-actions" id="user-info">
            <span class="username-display" id="username-display">–ì–æ—Å—Ç—å</span>
            <span id="verified-badge" class="verified-badge" style="display: none;">‚úì</span>
            <button class="admin-btn" onclick="showAdminLogin()" id="admin-button" style="display: none;">–ê–¥–º–∏–Ω</button>
            <button class="logout-btn" onclick="logout()" style="display: none;">–í—ã–π—Ç–∏</button>
        </div>
    </header>

    <div id="auth-section">
        <div class="auth-form" id="login-form">
            <span class="close-form" onclick="hideAuthForms()">√ó</span>
            <h2>–í—Ö–æ–¥</h2>
            <input type="text" id="login-username" placeholder="–õ–æ–≥–∏–Ω" required>
            <input type="password" id="login-password" placeholder="–ü–∞—Ä–æ–ª—å" required>
            <button onclick="login()">–í–æ–π—Ç–∏</button>
            <button onclick="showRegisterForm()">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
        </div>

        <div class="auth-form" id="register-form">
            <span class="close-form" onclick="hideAuthForms()">√ó</span>
            <h2>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
            <input type="text" id="register-username" placeholder="–õ–æ–≥–∏–Ω" required>
            <input type="password" id="register-password" placeholder="–ü–∞—Ä–æ–ª—å" required>
            <button onclick="register()">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
            <button onclick="showLoginForm()">–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç</button>
        </div>
    </div>

    <div class="upload-form" id="upload-form">
        <span class="close-form" onclick="toggleUploadForm()">√ó</span>
        <h2>–ó–∞–≥—Ä—É–∑–∏—Ç—å –≤–∏–¥–æ—Å</h2>
        <input type="text" id="video-title" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –≤–∏–¥–æ—Å–∞" required>
        <input type="text" id="video-url" placeholder="–°—Å—ã–ª–∫–∞ –Ω–∞ –≤–∏–¥–µ–æ (YouTube –∏–ª–∏ –¥—Ä—É–≥–æ–π URL)">
        <div class="file-upload">
            <label>–ò–ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞:</label>
            <input type="file" id="video-file" accept="video/*">
        </div>
        <div class="progress-bar" id="progress-bar">
            <div class="progress" id="progress"></div>
        </div>
        <button onclick="uploadVideo()">–ó–∞–≥—Ä—É–∑–∏—Ç—å!</button>
    </div>

    <div id="content-section" style="display: none;">
        <div class="video-container" id="videos">
            <!-- –í–∏–¥–µ–æ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è —Å—é–¥–∞ -->
        </div>
    </div>

    <div class="admin-panel" id="admin-panel">
        <h2>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h2>
        <button onclick="hideAdminPanel()">–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ —Å–∞–π—Ç</button>
        <h3>–°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h3>
        <table class="user-list">
            <thead>
                <tr>
                    <th>–õ–æ–≥–∏–Ω</th>
                    <th>–ü–æ–¥–ø–∏—Å—á–∏–∫–∏</th>
                    <th>–ó–∞–≥—Ä—É–∂–µ–Ω–æ –≤–∏–¥–µ–æ</th>
                    <th>–°—Ç–∞—Ç—É—Å</th>
                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
            </thead>
            <tbody id="users-table">
                <!-- –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
            </tbody>
        </table>
    </div>

    <div class="video-player" id="video-player">
        <div class="video-player-content">
            <span class="close-player" onclick="closeVideoPlayer()">√ó</span>
            <video id="video-frame" width="100%" controls></video>
        </div>
    </div>

    <div class="modal" id="admin-login-modal">
        <div class="modal-content">
            <h2>–í—Ö–æ–¥ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h2>
            <input type="text" id="admin-login" placeholder="–õ–æ–≥–∏–Ω" required>
            <input type="password" id="admin-password" placeholder="–ü–∞—Ä–æ–ª—å" required>
            <button onclick="adminLogin()">–í–æ–π—Ç–∏</button>
            <button onclick="hideAdminLogin()">–û—Ç–º–µ–Ω–∞</button>
        </div>
    </div>

    <div class="modal" id="ban-modal">
        <div class="modal-content">
            <h2>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω</h2>
            <p id="ban-reason">–ü—Ä–∏—á–∏–Ω–∞: —Å—ä–µ–º–∫–∞ –∑–∞–ø—Ä–µ—â–µ–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞</p>
            <button onclick="hideBanModal()">–ü–æ–Ω—è—Ç–Ω–æ</button>
        </div>
    </div>

    <script>
        // –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –≤–∏–¥–µ–æ
        let users = JSON.parse(localStorage.getItem('havnotube_users')) || [];
        let videos = JSON.parse(localStorage.getItem('havnotube_videos')) || [];
        let currentUser = null;
        let adminMode = false;

        // –ê–¥–º–∏–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        if (!users.some(u => u.username === 'Xavnotub')) {
            users.push({
                username: 'Xavnotub',
                password: '12344321',
                isAdmin: true,
                uploadedVideos: [],
                subscribers: [],
                likedVideos: []
            });
            localStorage.setItem('havnotube_users', JSON.stringify(users));
        }

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –∑–∞–ª–æ–≥–∏–Ω–µ–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
        function checkAuth() {
            const loggedInUser = localStorage.getItem('havnotube_currentUser');
            if (loggedInUser) {
                currentUser = JSON.parse(loggedInUser);
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∑–∞–±–∞–Ω–µ–Ω –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
                const userData = users.find(u => u.username === currentUser.username);
                if (userData && userData.isBanned) {
                    showBanModal(userData.banReason);
                    logout();
                    return;
                }
                
                updateUI();
            } else {
                hideAuthForms();
            }
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        function updateUI() {
            if (currentUser) {
                document.getElementById('auth-section').style.display = 'none';
                document.getElementById('content-section').style.display = 'block';
                document.getElementById('username-display').textContent = currentUser.username;
                document.querySelector('.logout-btn').style.display = 'block';
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –∞–¥–º–∏–Ω–∞, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–¥–º–∏–Ω
                const user = users.find(u => u.username === currentUser.username);
                if (user && user.isAdmin) {
                    document.getElementById('admin-button').style.display = 'block';
                } else {
                    document.getElementById('admin-button').style.display = 'none';
                }
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≥–∞–ª–æ—á–∫—É –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏, –µ—Å–ª–∏ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –µ—Å—Ç—å –ø–æ–¥–ø–∏—Å—á–∏–∫–∏
                if (user && user.subscribers && user.subscribers.length > 0) {
                    document.getElementById('verified-badge').style.display = 'inline';
                } else {
                    document.getElementById('verified-badge').style.display = 'none';
                }
                
                displayVideos();
            } else {
                document.getElementById('auth-section').style.display = 'block';
                document.getElementById('content-section').style.display = 'none';
                document.getElementById('login-form').style.display = 'block';
                document.getElementById('register-form').style.display = 'none';
                document.getElementById('username-display').textContent = '–ì–æ—Å—Ç—å';
                document.querySelector('.logout-btn').style.display = 'none';
                document.getElementById('verified-badge').style.display = 'none';
                document.getElementById('admin-button').style.display = 'none';
            }
            
            // –°–∫—Ä—ã–≤–∞–µ–º –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å, –µ—Å–ª–∏ –Ω–µ –≤ –∞–¥–º–∏–Ω-—Ä–µ–∂–∏–º–µ
            if (!adminMode) {
                document.getElementById('admin-panel').style.display = 'none';
            }
            
            // –°–∫—Ä—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É –∑–∞–≥—Ä—É–∑–∫–∏
            document.getElementById('upload-form').style.display = 'none';
        }

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É –∑–∞–≥—Ä—É–∑–∫–∏
        function toggleUploadForm() {
            if (!currentUser) {
                showLoginForm();
                return;
            }
            
            const form = document.getElementById('upload-form');
            form.style.display = form.style.display === 'none' ? 'block' : 'none';
        }

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
        function showRegisterForm() {
            document.getElementById('login-form').style.display = 'none';
            document.getElementById('register-form').style.display = 'block';
        }

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É –≤—Ö–æ–¥–∞
        function showLoginForm() {
            document.getElementById('register-form').style.display = 'none';
            document.getElementById('login-form').style.display = 'block';
        }

        // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Ñ–æ—Ä–º—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        function hideAuthForms() {
            document.getElementById('login-form').style.display = 'none';
            document.getElementById('register-form').style.display = 'none';
        }

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—Ö–æ–¥–∞ –≤ –∞–¥–º–∏–Ω–∫—É
        function showAdminLogin() {
            document.getElementById('admin-login-modal').style.display = 'flex';
        }

        // –°–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—Ö–æ–¥–∞ –≤ –∞–¥–º–∏–Ω–∫—É
        function hideAdminLogin() {
            document.getElementById('admin-login-modal').style.display = 'none';
        }

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –±–∞–Ω–∞
        function showBanModal(reason) {
            document.getElementById('ban-reason').textContent = `–ü—Ä–∏—á–∏–Ω–∞: ${reason || '–Ω–∞—Ä—É—à–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª —Å–∞–π—Ç–∞'}`;
            document.getElementById('ban-modal').style.display = 'flex';
        }

        // –°–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –±–∞–Ω–∞
        function hideBanModal() {
            document.getElementById('ban-modal').style.display = 'none';
        }

        // –í—Ö–æ–¥ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
        function adminLogin() {
            const login = document.getElementById('admin-login').value;
            const password = document.getElementById('admin-password').value;
            
            if (login === 'admin' && password === '12344321') {
                adminMode = true;
                hideAdminLogin();
                showAdminPanel();
            } else {
                const user = users.find(u => u.username === login && u.password === password && u.isAdmin);
                if (user) {
                    adminMode = true;
                    hideAdminLogin();
                    showAdminPanel();
                } else {
                    alert("–ù–µ–≤–µ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞!");
                }
            }
        }

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
        function showAdminPanel() {
            document.getElementById('content-section').style.display = 'none';
            document.getElementById('admin-panel').style.display = 'block';
            updateUsersTable();
        }

        // –°–∫—Ä—ã–≤–∞–µ–º –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
        function hideAdminPanel() {
            adminMode = false;
            document.getElementById('admin-panel').style.display = 'none';
            updateUI();
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–∞–±–ª–∏—Ü—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –∞–¥–º–∏–Ω–∫–µ
        function updateUsersTable() {
            const table = document.getElementById('users-table');
            table.innerHTML = '';
            
            users.forEach(user => {
                if (user.username === 'admin') return; // –ù–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–∞–º–æ–≥–æ –∞–¥–º–∏–Ω–∞
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${user.username}</td>
                    <td>${user.subscribers ? user.subscribers.length : 0}</td>
                    <td>${user.uploadedVideos ? user.uploadedVideos.length : 0}</td>
                    <td>${user.isBanned ? '–ó–∞–±–∞–Ω–µ–Ω' : '–ê–∫—Ç–∏–≤–µ–Ω'}</td>
                    <td>
                        ${user.isBanned ? 
                            `<button class="unban-btn" onclick="unbanUser('${user.username}')">–†–∞–∑–±–∞–Ω–∏—Ç—å</button>` : 
                            `<button class="ban-btn" onclick="banUser('${user.username}')">–ó–∞–±–∞–Ω–∏—Ç—å</button>`}
                        <button class="reset-btn" onclick="resetUserStats('${user.username}')">–û–±–Ω—É–ª–∏—Ç—å</button>
                    </td>
                `;
                table.appendChild(row);
            });
        }

        // –ë–∞–Ω–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function banUser(username) {
            const reason = prompt("–í–≤–µ–¥–∏—Ç–µ –ø—Ä–∏—á–∏–Ω—É –±–∞–Ω–∞:", "–°—ä–µ–º–∫–∞ –∑–∞–ø—Ä–µ—â–µ–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞");
            if (reason === null) return;
            
            const user = users.find(u => u.username === username);
            if (user) {
                user.isBanned = true;
                user.banReason = reason;
                localStorage.setItem('havnotube_users', JSON.stringify(users));
                
                // –ï—Å–ª–∏ –∑–∞–±–∞–Ω–µ–Ω —Ç–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å - —Ä–∞–∑–ª–æ–≥–∏–Ω–∏–≤–∞–µ–º –µ–≥–æ
                if (currentUser && currentUser.username === username) {
                    showBanModal(reason);
                    logout();
                }
                
                updateUsersTable();
            }
        }

        // –†–∞–∑–±–∞–Ω–∏–≤–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function unbanUser(username) {
            const user = users.find(u => u.username === username);
            if (user) {
                user.isBanned = false;
                user.banReason = '';
                localStorage.setItem('havnotube_users', JSON.stringify(users));
                updateUsersTable();
            }
        }

        // –û–±–Ω—É–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function resetUserStats(username) {
            if (!confirm(`–û–±–Ω—É–ª–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${username}?`)) return;
            
            const user = users.find(u => u.username === username);
            if (user) {
                // –£–¥–∞–ª—è–µ–º –≤—Å–µ –≤–∏–¥–µ–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                videos = videos.filter(video => video.author !== username);
                localStorage.setItem('havnotube_videos', JSON.stringify(videos));
                
                // –û–±–Ω—É–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                user.uploadedVideos = [];
                user.subscribers = [];
                user.likedVideos = [];
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–¥–ø–∏—Å–∫–∏ –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                users.forEach(u => {
                    if (u.subscriptions) {
                        u.subscriptions = u.subscriptions.filter(sub => sub !== username);
                    }
                });
                
                localStorage.setItem('havnotube_users', JSON.stringify(users));
                updateUsersTable();
                
                if (currentUser && currentUser.username === username) {
                    updateUI();
                }
            }
        }

        // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function register() {
            const username = document.getElementById('register-username').value;
            const password = document.getElementById('register-password').value;

            if (!username || !password) {
                alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!");
                return;
            }

            if (users.some(user => user.username === username)) {
                alert("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º –∏–º–µ–Ω–µ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!");
                return;
            }

            users.push({
                username,
                password,
                uploadedVideos: [],
                subscribers: [],
                likedVideos: [],
                isBanned: false
            });

            localStorage.setItem('havnotube_users', JSON.stringify(users));
            alert("–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! –¢–µ–ø–µ—Ä—å –≤–æ–π–¥–∏—Ç–µ.");
            showLoginForm();
        }

        // –í—Ö–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function login() {
            const username = document.getElementById('login-username').value;
            const password = document.getElementById('login-password').value;

            const user = users.find(user => user.username === username && user.password === password);
            
            if (user) {
                if (user.isBanned) {
                    showBanModal(user.banReason);
                    return;
                }
                
                currentUser = {
                    username: user.username,
                    isAdmin: user.isAdmin || false
                };
                localStorage.setItem('havnotube_currentUser', JSON.stringify(currentUser));
                updateUI();
                hideAuthForms();
            } else {
                alert("–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å!");
            }
        }

        // –í—ã—Ö–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function logout() {
            currentUser = null;
            adminMode = false;
            localStorage.removeItem('havnotube_currentUser');
            updateUI();
        }

        // –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–æ–≤–æ–µ –≤–∏–¥–µ–æ
        function uploadVideo() {
            if (!currentUser) {
                alert("–°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É!");
                return;
            }

            const title = document.getElementById('video-title').value;
            const url = document.getElementById('video-url').value;
            const fileInput = document.getElementById('video-file');
            const file = fileInput.files[0];

            if (!title) {
                alert("–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≤–∏–¥–µ–æ!");
                return;
            }

            if (!url && !file) {
                alert("–£–∫–∞–∂–∏—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ –≤–∏–¥–µ–æ –∏–ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª!");
                return;
            }

            if (file) {
                // –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ —Å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
                uploadFile(title, file);
                return;
            }

            // –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ —Å—Å—ã–ª–∫–µ
            const videoId = generateId();
            
            videos.push({
                id: videoId,
                title,
                url,
                views: 0,
                likes: 0,
                likedBy: [],
                author: currentUser.username,
                uploadDate: new Date().toLocaleDateString(),
                isExternal: true
            });

            // –î–æ–±–∞–≤–ª—è–µ–º –≤–∏–¥–µ–æ –≤ —Å–ø–∏—Å–æ–∫ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
            const user = users.find(user => user.username === currentUser.username);
            if (user) {
                if (!user.uploadedVideos) user.uploadedVideos = [];
                user.uploadedVideos.push(videoId);
                localStorage.setItem('havnotube_users', JSON.stringify(users));
            }

            localStorage.setItem('havnotube_videos', JSON.stringify(videos));
            displayVideos();

            // –û—á–∏—â–∞–µ–º –ø–æ–ª—è
            document.getElementById('video-title').value = '';
            document.getElementById('video-url').value = '';
            fileInput.value = '';
            document.getElementById('upload-form').style.display = 'none';
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ —Å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
        function uploadFile(title, file) {
            const progressBar = document.getElementById('progress-bar');
            const progress = document.getElementById('progress');
            
            progressBar.style.display = 'block';
            progress.style.width = '0%';
            
            // –ò–º–∏—Ç–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ (–≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—ã–ª –±—ã AJAX-–∑–∞–ø—Ä–æ—Å)
            let progressValue = 0;
            const interval = setInterval(() => {
                progressValue += 5;
                progress.style.width = `${progressValue}%`;
                
                if (progressValue >= 100) {
                    clearInterval(interval);
                    
                    // –°–æ–∑–¥–∞–µ–º URL –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
                    const videoUrl = URL.createObjectURL(file);
                    const videoId = generateId();
                    
                    videos.push({
                        id: videoId,
                        title,
                        url: videoUrl,
                        views: 0,
                        likes: 0,
                        likedBy: [],
                        author: currentUser.username,
                        uploadDate: new Date().toLocaleDateString(),
                        isExternal: false,
                        fileData: file.name
                    });

                    // –î–æ–±–∞–≤–ª—è–µ–º –≤–∏–¥–µ–æ –≤ —Å–ø–∏—Å–æ–∫ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
                    const user = users.find(user => user.username === currentUser.username);
                    if (user) {
                        if (!user.uploadedVideos) user.uploadedVideos = [];
                        user.uploadedVideos.push(videoId);
                        localStorage.setItem('havnotube_users', JSON.stringify(users));
                    }

                    localStorage.setItem('havnotube_videos', JSON.stringify(videos));
                    displayVideos();

                    // –û—á–∏—â–∞–µ–º –ø–æ–ª—è
                    document.getElementById('video-title').value = '';
                    document.getElementById('video-url').value = '';
                    document.getElementById('video-file').value = '';
                    progressBar.style.display = 'none';
                    document.getElementById('upload-form').style.display = 'none';
                    
                    alert("–í–∏–¥–µ–æ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ!");
                }
            }, 100);
        }

        // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –≤—Å–µ –≤–∏–¥–µ–æ
        function displayVideos() {
            const container = document.getElementById('videos');
            container.innerHTML = '';

            videos.forEach((video, index) => {
                const videoCard = document.createElement('div');
                videoCard.className = 'video-card';
                
                const isAuthor = currentUser && video.author === currentUser.username;
                const hasLiked = currentUser && video.likedBy && video.likedBy.includes(currentUser.username);
                
                videoCard.innerHTML = `
                    <img src="${getThumbnail(video)}" alt="${video.title}" onclick="watchVideo(${index})">
                    ${isAuthor ? `<button class="delete-btn" onclick="deleteVideo('${video.id}', event)">–£–¥–∞–ª–∏—Ç—å</button>` : ''}
                    <div class="video-title">${video.title}</div>
                    <div class="video-views">üëÄ ${video.views || 0} | üëç ${video.likes || 0}</div>
                    <div>–ê–≤—Ç–æ—Ä: ${video.author || '–ê–Ω–æ–Ω–∏–º'} 
                        ${users.find(u => u.username === video.author)?.subscribers?.length > 0 ? '<span class="verified-badge">‚úì</span>' : ''}
                    </div>
                    ${currentUser && video.author !== currentUser.username ? `
                        <button class="${isSubscribed(video.author) ? 'unsubscribe-btn' : 'subscribe-btn'}" 
                                onclick="${isSubscribed(video.author) ? 'unsubscribe' : 'subscribe'}('${video.author}')">
                            ${isSubscribed(video.author) ? '–û—Ç–ø–∏—Å–∞—Ç—å—Å—è' : '–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è'}
                        </button>
                    ` : ''}
                    <button onclick="watchVideo(${index})">–°–º–æ—Ç—Ä–µ—Ç—å</button>
                    <button onclick="likeVideo(${index})" ${hasLiked ? 'disabled style="opacity:0.5"' : ''}>
                        ${hasLiked ? '–õ–∞–π–∫ –ø–æ—Å—Ç–∞–≤–ª–µ–Ω' : '–õ–∞–π–∫'}
                    </button>
                `;
                container.appendChild(videoCard);
            });
        }

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø–æ–¥–ø–∏—Å–∞–Ω –ª–∏ —Ç–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞ –∞–≤—Ç–æ—Ä–∞
        function isSubscribed(authorUsername) {
            if (!currentUser) return false;
            const user = users.find(u => u.username === currentUser.username);
            return user.subscriptions && user.subscriptions.includes(authorUsername);
        }

        // –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∞–≤—Ç–æ—Ä–∞
        function subscribe(authorUsername) {
            if (!currentUser) {
                alert("–°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É!");
                return;
            }
            
            const user = users.find(u => u.username === currentUser.username);
            const author = users.find(u => u.username === authorUsername);
            
            if (!user.subscriptions) user.subscriptions = [];
            if (!author.subscribers) author.subscribers = [];
            
            user.subscriptions.push(authorUsername);
            author.subscribers.push(currentUser.username);
            
            localStorage.setItem('havnotube_users', JSON.stringify(users));
            displayVideos();
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—é –∞–≤—Ç–æ—Ä–∞
            checkVerification(authorUsername);
        }

        // –û—Ç–ø–∏—Å–∞—Ç—å—Å—è –æ—Ç –∞–≤—Ç–æ—Ä–∞
        function unsubscribe(authorUsername) {
            if (!currentUser) return;
            
            const user = users.find(u => u.username === currentUser.username);
            const author = users.find(u => u.username === authorUsername);
            
            if (user.subscriptions) {
                user.subscriptions = user.subscriptions.filter(sub => sub !== authorUsername);
            }
            
            if (author.subscribers) {
                author.subscribers = author.subscribers.filter(sub => sub !== currentUser.username);
            }
            
            localStorage.setItem('havnotube_users', JSON.stringify(users));
            displayVideos();
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—é –∞–≤—Ç–æ—Ä–∞
            checkVerification(authorUsername);
        }

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (2+ –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤)
        function checkVerification(username) {
            const user = users.find(u => u.username === username);
            if (user) {
                const hasSubscribers = user.subscribers && user.subscribers.length > 2;
                
                // –ï—Å–ª–∏ —Ç–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å - —ç—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º—ã–π, –æ–±–Ω–æ–≤–ª—è–µ–º UI
                if (currentUser && currentUser.username === username) {
                    document.getElementById('verified-badge').style.display = hasSubscribers ? 'inline' : 'none';
                }
            }
        }

        // –°–º–æ—Ç—Ä–∏–º –≤–∏–¥–µ–æ (—É–≤–µ–ª–∏—á–∏–≤–∞–µ–º –ø—Ä–æ—Å–º–æ—Ç—Ä—ã)
        function watchVideo(index) {
            videos[index].views = (videos[index].views || 0) + 2;
            localStorage.setItem('havnotube_videos', JSON.stringify(videos));
            
            const video = videos[index];
            const player = document.getElementById('video-player');
            const frame = document.getElementById('video-frame');
            
            if (video.isExternal) {
                if (isYouTubeUrl(video.url)) {
                    const videoId = getYouTubeId(video.url);
                    frame.innerHTML = `<iframe width="100%" height="450" src="https://www.youtube.com/embed/${videoId}?autoplay=1" frameborder="0" allowfullscreen></iframe>`;
                } else {
                    frame.innerHTML = `<iframe width="100%" height="450" src="${video.url}" frameborder="0" allowfullscreen></iframe>`;
                }
            } else {
                frame.innerHTML = `<source src="${video.url}" type="video/mp4">`;
                frame.load();
            }
            
            player.style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }

        // –ó–∞–∫—Ä—ã–≤–∞–µ–º –ø–ª–µ–µ—Ä
        function closeVideoPlayer() {
            const player = document.getElementById('video-player');
            const frame = document.getElementById('video-frame');
            frame.innerHTML = '';
            player.style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        // –°—Ç–∞–≤–∏–º –ª–∞–π–∫ (1 –ª–∞–π–∫ –æ—Ç 1 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
        function likeVideo(index) {
            if (!currentUser) {
                alert("–°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É!");
                return;
            }
            
            const video = videos[index];
            
            if (!video.likedBy) video.likedBy = [];
            
            if (video.likedBy.includes(currentUser.username)) {
                alert("–í—ã —É–∂–µ –ª–∞–π–∫–Ω—É–ª–∏ —ç—Ç–æ –≤–∏–¥–µ–æ!");
                return;
            }
            
            video.likes = (video.likes || 0) + 1;
            video.likedBy.push(currentUser.username);
            
            // –î–æ–±–∞–≤–ª—è–µ–º –≤ —Å–ø–∏—Å–æ–∫ –ª–∞–π–∫–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            const user = users.find(u => u.username === currentUser.username);
            if (user) {
                if (!user.likedVideos) user.likedVideos = [];
                user.likedVideos.push(video.id);
            }
            
            localStorage.setItem('havnotube_videos', JSON.stringify(videos));
            localStorage.setItem('havnotube_users', JSON.stringify(users));
            displayVideos();
        }

        // –£–¥–∞–ª—è–µ–º –≤–∏–¥–µ–æ
        function deleteVideo(videoId, event) {
            event.stopPropagation();
            
            if (!confirm("–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ –≤–∏–¥–µ–æ?")) return;
            
            // –£–¥–∞–ª—è–µ–º –≤–∏–¥–µ–æ –∏–∑ –æ–±—â–µ–≥–æ —Å–ø–∏—Å–∫–∞
            videos = videos.filter(video => video.id !== videoId);
            localStorage.setItem('havnotube_videos', JSON.stringify(videos));
            
            // –£–¥–∞–ª—è–µ–º –≤–∏–¥–µ–æ –∏–∑ —Å–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            const user = users.find(u => u.username === currentUser.username);
            if (user) {
                user.uploadedVideos = user.uploadedVideos.filter(id => id !== videoId);
                localStorage.setItem('havnotube_users', JSON.stringify(users));
            }
            
            // –£–¥–∞–ª—è–µ–º –∏–∑ –ª–∞–π–∫–æ–≤ –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
            users.forEach(u => {
                if (u.likedVideos) {
                    u.likedVideos = u.likedVideos.filter(id => id !== videoId);
                }
            });
            
            localStorage.setItem('havnotube_users', JSON.stringify(users));
            displayVideos();
        }

        // –ü–æ–ª—É—á–∞–µ–º ID YouTube-–≤–∏–¥–µ–æ (–µ—Å–ª–∏ —Å—Å—ã–ª–∫–∞ —Å —é—Ç—É–±–∞)
        function getYouTubeId(url) {
            if (!url) return null;
            const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/;
            const match = url.match(regExp);
            return (match && match[2].length === 11) ? match[2] : null;
        }

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, YouTube –ª–∏ —ç—Ç–æ —Å—Å—ã–ª–∫–∞
        function isYouTubeUrl(url) {
            return url && (url.includes('youtube.com') || url.includes('youtu.be'));
        }

        // –ü–æ–ª—É—á–∞–µ–º –º–∏–Ω–∏–∞—Ç—é—Ä—É –¥–ª—è –≤–∏–¥–µ–æ
        function getThumbnail(video) {
            if (video.isExternal && isYouTubeUrl(video.url)) {
                const videoId = getYouTubeId(video.url);
                return videoId ? `https://img.youtube.com/vi/${videoId}/0.jpg` : 'https://via.placeholder.com/300x180';
            }
            return 'https://via.placeholder.com/300x180';
        }

        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º ID –¥–ª—è –≤–∏–¥–µ–æ
        function generateId() {
            return Math.random().toString(36).substr(2, 9);
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.onload = function() {
            checkAuth();
        };
    </script>
</body>
</html> 